.PHONY: build test run clean docker help

BINARY_NAME=calculator
CLI_BINARY=bin/$(BINARY_NAME)-cli
WEB_BINARY=bin/$(BINARY_NAME)-web

help:
	@echo "Available commands:"
	@echo "  make build     - Build both CLI and web binaries"
	@echo "  make cli       - Build only CLI binary"
	@echo "  make web       - Build only web binary"
	@echo "  make run-cli   - Run CLI in interactive mode"
	@echo "  make run-web   - Run web server"
	@echo "  make test      - Run tests"
	@echo "  make clean     - Clean build artifacts"
	@echo "  make docker    - Build Docker image"

build: cli web

cli:
	@echo "Building CLI..."
	mkdir -p bin
	go build -o $(CLI_BINARY) ./cmd/cli
	@echo "CLI built: $(CLI_BINARY)"

web:
	@echo "Building web server..."
	mkdir -p bin
	go build -o $(WEB_BINARY) ./cmd/web
	@echo "Web server built: $(WEB_BINARY)"

run-cli: cli
	@echo "Starting CLI..."
	./$(CLI_BINARY) -i

run-web: web
	@echo "Starting web server..."
	PORT=8080 ./$(WEB_BINARY)

test:
	@echo "Running tests..."
	go test ./...

clean:
	@echo "Cleaning..."
	rm -rf bin/
	go clean

docker:
	@echo "Building Docker image..."
	docker build -t calculator:latest .

fmt:
	go fmt ./...

vet:
	go vet ./...

lint: fmt vet
	@echo "Linting complete"